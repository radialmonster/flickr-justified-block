/**
 * Flickr Justified Block Styles - Justified Gallery Layout
 */

/* The main container - justified gallery layout */
.flickr-justified-grid {
    --gap: 12px;
    display: flex;
    flex-direction: column;
    gap: var(--gap);
    width: 100%;
}

/* Single image alignment - applied to rows within single-image grids to prevent flash */
.flickr-justified-grid[data-single-image-alignment="left"] .flickr-row {
    justify-content: flex-start;
}

.flickr-justified-grid[data-single-image-alignment="center"] .flickr-row {
    justify-content: center;
}

.flickr-justified-grid[data-single-image-alignment="right"] .flickr-row {
    justify-content: flex-end;
}

/* Initial alignment before JavaScript creates rows - prevents flash */
.flickr-justified-grid[data-single-image-alignment="left"]:not(.justified-initialized) {
    align-items: flex-start;
    justify-content: flex-start;
}

.flickr-justified-grid[data-single-image-alignment="center"]:not(.justified-initialized) {
    align-items: center;
    justify-content: center;
}

.flickr-justified-grid[data-single-image-alignment="right"]:not(.justified-initialized) {
    align-items: flex-end;
    justify-content: flex-end;
}

/* Row container for images */
.flickr-row {
    display: flex;
    gap: var(--gap);
    width: 100%;
    align-items: flex-start;
    justify-content: flex-start;
}

/* Individual card styles - dimensions set by JavaScript */
.flickr-card {
    background: transparent;
    border-radius: 8px;
    overflow: hidden;
    box-sizing: border-box;
    flex: 0 0 auto; /* Prevent shrinking/growing from JS-calculated size */
}

/* Images sized by JavaScript - maintain crisp display */
.flickr-card img {
    display: block;
    object-fit: cover; /* Cover the container for justified layout */
    width: 100%;
    height: 100%;
    max-width: none; /* neutralize global img resets */
    object-position: center; /* nicer crops */
}

/* Helps reduce CLS while images decode */
.flickr-card img[loading="lazy"] {
    content-visibility: auto;
    contain-intrinsic-size: 300px 200px; /* pick a sensible average */
}

/* Staging container for new cards during layout */
.flickr-staging {
    display: none;
}

/* Make anchor fill the card (consistent click target) */
.flickr-card > a {
    display: block;
    width: 100%;
    height: 100%;
}

/* Individual gallery item links */
.flickr-card .flickr-justified-item,
.flickr-card .flickr-builtin-lightbox {
    display: block;
    width: 100%;
    text-decoration: none;
    color: inherit;
}

/* Focus states for accessibility */
.flickr-card .flickr-justified-item:focus,
.flickr-card .flickr-builtin-lightbox:focus {
    outline: 2px solid #005cee;
    outline-offset: 2px;
}

/* --- Gallery Layout Styles --- */

/* Editor-specific styles */
.flickr-justified-block-editor {
    display: grid;
    grid-template-columns: repeat(var(--fm-columns, 3), 1fr);
    gap: var(--fm-gap, 16px);
    min-height: 100px;
}

/* Responsive design for editor */
@media (max-width: 1024px) {
    .flickr-justified-block-editor {
        grid-template-columns: repeat(2, 1fr) !important;
    }
}

@media (max-width: 640px) {
    .flickr-justified-block-editor {
        grid-template-columns: 1fr !important;
    }
}

/* Loading state for images */
.flickr-card img[src=""] {
    background: #f0f0f0;
    min-height: 200px;
}

/* Alignment support */
.wp-block-flickr-justified-block.alignwide {
    max-width: 1200px;
    margin-left: auto;
    margin-right: auto;
}

.wp-block-flickr-justified-block.alignfull {
    max-width: none;
    width: 100vw;
    position: relative;
    left: 50%;
    right: 50%;
    margin-left: -50vw;
    margin-right: -50vw;
}

/* High contrast mode support */
@media (prefers-contrast: high) {
    .flickr-card {
        border: 1px solid currentColor;
    }
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
    .flickr-card,
    .flickr-card img {
        transition: none;
    }
}

/* PhotoSwipe theme protection and mobile enhancements */

/* Keep PhotoSwipe slide images from inheriting global img rules */
.pswp img {
    max-width: none !important;
    height: auto;
}

/* Give the PhotoSwipe top bar consistent spacing */
.pswp__top-bar {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 8px 12px 8px 10px;
}

/* Base styling for the Flickr attribution control */
.pswp__button--flickr-attribution {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.35em;
    font-size: 13px;
    line-height: 1.25;
    color: #fff;
    text-decoration: underline;
    background-color: rgba(0, 0, 0, 0.35);
    border-radius: 4px;
    padding: 6px 12px;
    margin-right: 8px;
    white-space: nowrap;
    transition: background-color 0.2s ease;
}

.pswp__button--flickr-attribution:hover,
.pswp__button--flickr-attribution:focus-visible {
    background-color: rgba(0, 0, 0, 0.6);
    color: #fff;
}

.pswp__button--flickr-attribution:focus-visible {
    outline: 2px solid rgba(255, 255, 255, 0.6);
    outline-offset: 2px;
}

/* Respect notches / dynamic islands */
.pswp {
    padding-top: env(safe-area-inset-top);
    padding-bottom: env(safe-area-inset-bottom);
}

/* Fullscreen container for mobile */
.pswp-fullscreen-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    width: 100dvw; /* Dynamic viewport width */
    height: 100dvh; /* Dynamic viewport height */
    background: #000;
    z-index: 999999;
}

/* Ensure PhotoSwipe inside fullscreen container uses full space */
.pswp-fullscreen-container .pswp {
    width: 100% !important;
    height: 100% !important;
}

/* In landscape mode, ensure no padding issues */
@media (orientation: landscape) and (max-width: 1024px) {
    .pswp-fullscreen-container {
        padding: 0 !important;
        margin: 0 !important;
    }

    .pswp-fullscreen-container .pswp {
        padding: 0 !important;
    }

    /* Adjust top bar for landscape */
    .pswp-fullscreen-container .pswp__top-bar {
        padding: 6px 10px;
    }
}


/* Mobile: keep controls compact without forcing a second row */
@media (max-width: 768px) {
  .pswp__top-bar {
    align-items: center;
    gap: 8px 10px;
    padding: 10px;
  }

  .pswp__counter {
    order: 0;
    flex: 1 1 auto;
    min-width: 0;
    margin-right: 0;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .pswp__button--zoom {
    order: 1;
    margin-left: auto;
  }

  .pswp__button--close {
    order: 2;
  }

  .pswp__button--flickr-attribution {
    order: 3;
    margin-right: 0;
    white-space: nowrap;
    justify-content: center;
    padding: 8px 12px;
  }

  .pswp__button svg,
  .pswp__preloader .pswp__icn {
    width: 24px;
    height: 24px;
  }
}

/* On very narrow phones, keep controls visible but reduce chrome */
@media (max-width: 420px) {
  .pswp__top-bar {
    flex-wrap: wrap;
  }

  .pswp__counter {
    order: 3;
    width: 100%;
    text-align: center;
  }
}

/* Async loading states */
.flickr-justified-loading {
    padding: 40px;
    text-align: center;
    background: #f0f0f1;
    border-radius: 4px;
}

.flickr-justified-loading p {
    margin: 0;
    color: #666;
}

.flickr-justified-loading p.flickr-loading-icon {
    margin-bottom: 10px;
}

.flickr-justified-loading .dashicons {
    animation: rotation 2s infinite linear;
    font-size: 24px;
}

.flickr-loading-retry {
    margin: 0 !important;
    color: #666 !important;
}

@keyframes rotation {
    from { transform: rotate(0deg); }
    to { transform: rotate(359deg); }
}
